/*Define que o schema padrao, deve ser mapeado no workspace*/
use dfs.receita_federal;
/*Exibe os arquivos que est√£o no workspace*/
show files;
/*Configura a gravacao em formato Parquet*/
ALTER SESSION SET `store.format` = 'parquet';

/*Tabela criada em etapa anterior con os registros de CNPJ*/
select * from receita_federal_cnpj;

/*Cria tabela com colunas do layout de CNPJ*/
drop table cnpj_tabulado;

create table cnpj_tabulado as
SELECT
	SUBSTRING(REGISTRO,1,1) INDICADOR_FULL_DIARIO,
	SUBSTRING(REGISTRO,2,1) TIPO_ATUALIZACAO,
	SUBSTRING(REGISTRO,3,14) CNPJ,
	SUBSTRING(REGISTRO,17,1) MATRIZ_FILIAL,
	SUBSTRING(REGISTRO,18,150) RAZAO_SOCIAL,
	SUBSTRING(REGISTRO,168,55) NOME_FANTASIA,
	SUBSTRING(REGISTRO,223,2) SITUACAO_CADASTRAL,
	SUBSTRING(REGISTRO,225,8) DATA_SITUACAO_CADASTRAL,
	SUBSTRING(REGISTRO,233,2) MOTIVO_SITUACAO_CADASTRAL,
	SUBSTRING(REGISTRO,235,55) NOME_CIDADE_EXTERIOR,
	SUBSTRING(REGISTRO,290,3) CODIGO_PAIS,
	SUBSTRING(REGISTRO,293,70) NOME_PAIS,
	SUBSTRING(REGISTRO,363,4) CODIGO_NATUREZA_JURIDICA,
	SUBSTRING(REGISTRO,367,8) DATA_INICIO_ATIVIDADE,
	SUBSTRING(REGISTRO,375,7) CNAE_FISCAL,
	SUBSTRING(REGISTRO,382,20) TIPO_LOGRADOURO,
	SUBSTRING(REGISTRO,402,60) LOGRADOURO,
	SUBSTRING(REGISTRO,462,6) NUMERO,
	SUBSTRING(REGISTRO,468,156) COMPLEMENTO,
	SUBSTRING(REGISTRO,624,50) BAIRRO,
	SUBSTRING(REGISTRO,674,8) CEP,
	SUBSTRING(REGISTRO,682,2) UF,
	SUBSTRING(REGISTRO,684,4) CODIGO_MUNICIPIO,
	SUBSTRING(REGISTRO,688,50) MUNICIPIO,
	SUBSTRING(REGISTRO,738,12) DDD_TELEFONE_1,
	SUBSTRING(REGISTRO,738,4) DDD_1,
	SUBSTRING(REGISTRO,742,8) TELEFONE_1,
	SUBSTRING(REGISTRO,750,12) DDD_TELEFONE_2,
	SUBSTRING(REGISTRO,750,4) DDD_2,
	SUBSTRING(REGISTRO,754,8) TELEFONE_2,
	SUBSTRING(REGISTRO,762,12) DDD_FAX_3,
	SUBSTRING(REGISTRO,762,4) DDD_3,
	SUBSTRING(REGISTRO,766,8) FAX_3,
	SUBSTRING(REGISTRO,774,115) EMAIL,
	SUBSTRING(REGISTRO,889,2) QUALIFICACAO_RESPONSAVEL,
	SUBSTRING(REGISTRO,891,14) CAPITAL_SOCIAL,
	SUBSTRING(REGISTRO,905,2) PORTE_EMPRESA,
	SUBSTRING(REGISTRO,907,1) OPCAO_SIMPLES,
	SUBSTRING(REGISTRO,908,8) DATA_OPCAO_SIMPLES,
	SUBSTRING(REGISTRO,916,8) DATA_EXCLUSAO_SIMPLES,
	SUBSTRING(REGISTRO,924,1) OPCAO_MEI,
	SUBSTRING(REGISTRO,925,23) SITUACAO_ESPECIAL,
	SUBSTRING(REGISTRO,948,8) DATA_SITUACAO_ESPECIAL,
	SUBSTRING(REGISTRO,956,243) FILLER,
	SUBSTRING(REGISTRO,1199,1) FIM_REGISTRO
FROM receita_federal_cnpj;

select * from cnpj_tabulado;

/*Cria tabela com colunas do layout de Socio*/
drop table  socio_tabulado;

create table socio_tabulado as
SELECT
	SUBSTRING(REGISTRO,1,1) INDICADOR_FULL_DIARIO,
	SUBSTRING(REGISTRO,2,1) TIPO_ATUALIZACAO,
	SUBSTRING(REGISTRO,3,14) CNPJ,
	SUBSTRING(REGISTRO,17,1) IDENTIFICADOR_SOCIO,
	SUBSTRING(REGISTRO,18,150) NOME_SOCIO,
	SUBSTRING(REGISTRO,168,14) CNPJ_CPF_SOCIO,
	SUBSTRING(REGISTRO,182,2) CODIGO_QUALIFICADO_SOCIO,
	SUBSTRING(REGISTRO,184,5) PERCENTUAL_CAPITAL_SOCIAL,
	SUBSTRING(REGISTRO,189,8) DATA_ENTRADA_SOCIEDADE,
	SUBSTRING(REGISTRO,197,3) CODIGO_PAIS_SOCIO,
	SUBSTRING(REGISTRO,200,70) NOME_PAIS_SOCIO,
	SUBSTRING(REGISTRO,270,11) CPF_REPRESENTANTE_LEGAL,
	SUBSTRING(REGISTRO,281,60) NOME_REPRESENTANTE,
	SUBSTRING(REGISTRO,341,2) CODIGO_QUALIFICADO_REPRESENTANTE_LEGAL,
	SUBSTRING(REGISTRO,343,855) FILLER,
	SUBSTRING(REGISTRO,1199,1) FIM_REGISTRO
FROM receita_federal_socio;

select * from socio_tabulado;

/*Cria tabela com colunas do layout de CNAE*/

drop table  cnae_tabulado;

create table cnae_tabulado as
SELECT
	SUBSTRING(REGISTRO,1,1) INDICADOR_FULL_DIARIO,
	SUBSTRING(REGISTRO,2,1) TIPO_ATUALIZACAO,
	SUBSTRING(REGISTRO,3,14) CNPJ,
	SUBSTRING(REGISTRO,17,7) CNAE_1,
	SUBSTRING(REGISTRO,24,7) CNAE_2,
	SUBSTRING(REGISTRO,31,7) CNAE_3,
	SUBSTRING(REGISTRO,38,7) CNAE_4,
	SUBSTRING(REGISTRO,45,7) CNAE_5,
	SUBSTRING(REGISTRO,52,7) CNAE_6,
	SUBSTRING(REGISTRO,59,7) CNAE_7,
	SUBSTRING(REGISTRO,66,7) CNAE_8,
	SUBSTRING(REGISTRO,73,7) CNAE_9,
	SUBSTRING(REGISTRO,80,7) CNAE_10,
	SUBSTRING(REGISTRO,87,7) CNAE_11,
	SUBSTRING(REGISTRO,94,7) CNAE_12,
	SUBSTRING(REGISTRO,101,7) CNAE_13,
	SUBSTRING(REGISTRO,108,7) CNAE_14,
	SUBSTRING(REGISTRO,115,7) CNAE_15,
	SUBSTRING(REGISTRO,122,7) CNAE_16,
	SUBSTRING(REGISTRO,129,7) CNAE_17,
	SUBSTRING(REGISTRO,136,7) CNAE_18,
	SUBSTRING(REGISTRO,143,7) CNAE_19,
	SUBSTRING(REGISTRO,150,7) CNAE_20,
	SUBSTRING(REGISTRO,157,7) CNAE_21,
	SUBSTRING(REGISTRO,164,7) CNAE_22,
	SUBSTRING(REGISTRO,171,7) CNAE_23,
	SUBSTRING(REGISTRO,178,7) CNAE_24,
	SUBSTRING(REGISTRO,185,7) CNAE_25,
	SUBSTRING(REGISTRO,192,7) CNAE_26,
	SUBSTRING(REGISTRO,199,7) CNAE_27,
	SUBSTRING(REGISTRO,206,7) CNAE_28,
	SUBSTRING(REGISTRO,213,7) CNAE_29,
	SUBSTRING(REGISTRO,220,7) CNAE_30,
	SUBSTRING(REGISTRO,227,7) CNAE_31,
	SUBSTRING(REGISTRO,234,7) CNAE_32,
	SUBSTRING(REGISTRO,241,7) CNAE_33,
	SUBSTRING(REGISTRO,248,7) CNAE_34,
	SUBSTRING(REGISTRO,255,7) CNAE_35,
	SUBSTRING(REGISTRO,262,7) CNAE_36,
	SUBSTRING(REGISTRO,269,7) CNAE_37,
	SUBSTRING(REGISTRO,276,7) CNAE_38,
	SUBSTRING(REGISTRO,283,7) CNAE_39,
	SUBSTRING(REGISTRO,290,7) CNAE_40,
	SUBSTRING(REGISTRO,297,7) CNAE_41,
	SUBSTRING(REGISTRO,304,7) CNAE_42,
	SUBSTRING(REGISTRO,311,7) CNAE_43,
	SUBSTRING(REGISTRO,318,7) CNAE_44,
	SUBSTRING(REGISTRO,325,7) CNAE_45,
	SUBSTRING(REGISTRO,332,7) CNAE_46,
	SUBSTRING(REGISTRO,339,7) CNAE_47,
	SUBSTRING(REGISTRO,346,7) CNAE_48,
	SUBSTRING(REGISTRO,353,7) CNAE_49,
	SUBSTRING(REGISTRO,360,7) CNAE_50,
	SUBSTRING(REGISTRO,367,7) CNAE_51,
	SUBSTRING(REGISTRO,374,7) CNAE_52,
	SUBSTRING(REGISTRO,381,7) CNAE_53,
	SUBSTRING(REGISTRO,388,7) CNAE_54,
	SUBSTRING(REGISTRO,395,7) CNAE_55,
	SUBSTRING(REGISTRO,402,7) CNAE_56,
	SUBSTRING(REGISTRO,409,7) CNAE_57,
	SUBSTRING(REGISTRO,416,7) CNAE_58,
	SUBSTRING(REGISTRO,423,7) CNAE_59,
	SUBSTRING(REGISTRO,430,7) CNAE_60,
	SUBSTRING(REGISTRO,437,7) CNAE_61,
	SUBSTRING(REGISTRO,444,7) CNAE_62,
	SUBSTRING(REGISTRO,451,7) CNAE_63,
	SUBSTRING(REGISTRO,458,7) CNAE_64,
	SUBSTRING(REGISTRO,465,7) CNAE_65,
	SUBSTRING(REGISTRO,472,7) CNAE_66,
	SUBSTRING(REGISTRO,479,7) CNAE_67,
	SUBSTRING(REGISTRO,486,7) CNAE_68,
	SUBSTRING(REGISTRO,493,7) CNAE_69,
	SUBSTRING(REGISTRO,500,7) CNAE_70,
	SUBSTRING(REGISTRO,507,7) CNAE_71,
	SUBSTRING(REGISTRO,514,7) CNAE_72,
	SUBSTRING(REGISTRO,521,7) CNAE_73,
	SUBSTRING(REGISTRO,528,7) CNAE_74,
	SUBSTRING(REGISTRO,535,7) CNAE_75,
	SUBSTRING(REGISTRO,542,7) CNAE_76,
	SUBSTRING(REGISTRO,549,7) CNAE_77,
	SUBSTRING(REGISTRO,556,7) CNAE_78,
	SUBSTRING(REGISTRO,563,7) CNAE_79,
	SUBSTRING(REGISTRO,570,7) CNAE_80,
	SUBSTRING(REGISTRO,577,7) CNAE_81,
	SUBSTRING(REGISTRO,584,7) CNAE_82,
	SUBSTRING(REGISTRO,591,7) CNAE_83,
	SUBSTRING(REGISTRO,598,7) CNAE_84,
	SUBSTRING(REGISTRO,605,7) CNAE_85,
	SUBSTRING(REGISTRO,612,7) CNAE_86,
	SUBSTRING(REGISTRO,619,7) CNAE_87,
	SUBSTRING(REGISTRO,626,7) CNAE_88,
	SUBSTRING(REGISTRO,633,7) CNAE_89,
	SUBSTRING(REGISTRO,640,7) CNAE_90,
	SUBSTRING(REGISTRO,647,7) CNAE_91,
	SUBSTRING(REGISTRO,654,7) CNAE_92,
	SUBSTRING(REGISTRO,661,7) CNAE_93,
	SUBSTRING(REGISTRO,668,7) CNAE_94,
	SUBSTRING(REGISTRO,675,7) CNAE_95,
	SUBSTRING(REGISTRO,682,7) CNAE_96,
	SUBSTRING(REGISTRO,689,7) CNAE_97,
	SUBSTRING(REGISTRO,696,7) CNAE_98,
	SUBSTRING(REGISTRO,703,7) CNAE_99,
	SUBSTRING(REGISTRO,710,489) FILLER,
	SUBSTRING(REGISTRO,1199,1) FIM_REGISTRO
FROM receita_federal_cnae;

select * from cnae_tabulado;
